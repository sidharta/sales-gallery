<loading ng-if="technology.loading"></loading>
<div class="technology" ng-if="!technology.loading">
  <div class="content container">
    <div class="row">
      <div class="col-md-10 col-md-offset-1" ng-if="app.alert.message.length">
        <uib-alert type="{{ app.alert.type }}" close="app.closeAlert()">
          {{ app.alert.message }}
        </uib-alert>
      </div>

      <div class="col-md-10 col-md-offset-1">
        <div class="card no-margin">
          <div class="card-section">
            <h1 class="card-title" ng-if="!technology.id.length">Adicionar nova proposta</h1>
            <h1 class="card-title" ng-if="technology.id.length">Editar proposta</h1>
          </div>
          <div class="card-section">
            <form id="addTechnologyForm" name="addTechnologyForm" ng-submit="technology.addOrUpdateTechnology(addTechnologyForm)" novalidate>
              <div class="row">
                <div class="form-group col-md-6">
                  <div class="media">
                    <div id="div_image" class="media-left">
                      <output id="list">
                        <label for="technology-image"><img src="assets/images/no_image.png" title="Insira uma imagem"></label>
                      </output>
                    </div>
                    <div class="media-body">
                      <label for="technology-image">Imagem</label>
                      <input type="file" class="form-control" id="technology-image" ng-model="technology.image" onchange="angular.element(this).scope().handleFileSelect(this)">
                      <span class="help-block">Tamanho: 100x100</span>
                    </div>
                  </div>
                </div>
                <div class="form-group col-md-6" ng-class="{'has-error': (addTechnologyForm.pipedriveLink.$invalid && addTechnologyForm.pipedriveLink.$touched) || (addTechnologyForm.$submitted && addTechnologyForm.pipedriveLink.$invalid)}">
                  <label for="pipedrive-link">Link Pipedrive</label>
                  <input type="text" class="form-control"  id="technology-pipedriveLink" ng-model="technology.pipedriveLink"
                  ng-if="!technology.id || !technology.hasPipedriveLink"
                  ng-pattern='technology.regexPipedrive' ng-blur="technology.onLostFocus(technology.pipedriveLink)"
                  name="pipedriveLink" placeholder="Ex: https://citsoftware.pipedrive.com/deal/{id}">
                  <a readonly target="_blank" class="form-control" ng-href="{{technology.pipedriveLink}}" ng-if="technology.id && technology.hasPipedriveLink">{{ technology.pipedriveLink }}</a>
                  <div ng-show="addTechnologyForm.$submitted || addTechnologyForm.pipedriveLink.$touched">
                    <span ng-show="addTechnologyForm.pipedriveLink.$invalid" class="help-block">O link do pipedrive está incorreto</span>
                  </div>
                </div>
              </div>
              <hr>
              <div class="row">
                <div class="form-group col-md-6" ng-class="{'has-error': (addTechnologyForm.name.$invalid && addTechnologyForm.name.$touched) || (addTechnologyForm.$submitted && addTechnologyForm.name.$invalid)}">
                  <label for="technology-name">Nome da proposta</label>
                  <input type="text" class="form-control"  ng-disabled="technology.loadedByPipedrive" id="technology-name" name="name" ng-model="technology.name" placeholder="Ex.: GPV Ferrovias" required="" ng-disabled="technology.id.length">
                  <div ng-show="addTechnologyForm.$submitted || addTechnologyForm.name.$touched">
                    <span ng-show="addTechnologyForm.name.$error.required" class="help-block">O campo Nome é obrigatório</span>
                  </div>
                </div>
                <div class="form-group col-md-6" ng-class="{'has-error': (addTechnologyForm.client.$invalid && addTechnologyForm.client.$touched) || (addTechnologyForm.$submitted && addTechnologyForm.client.$invalid)}">
                  <label for="technology-client">Nome do cliente</label>
                  <input type="text" class="form-control" id="technology-client" ng-disabled="technology.loadedByPipedrive" name="client" ng-model="technology.client" required placeholder="nome do cliente">
                  <div ng-show="addTechnologyForm.$submitted || addTechnologyForm.client.$touched">
                    <span ng-show="addTechnologyForm.client.$error.required" class="help-block">O campo Cliente é obrigatório</span>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="form-group col-md-6" ng-class="{'has-error': (addTechnologyForm.ownerEmail.$invalid && addTechnologyForm.ownerEmail.$touched) || (addTechnologyForm.$submitted && addTechnologyForm.ownerEmail.$invalid)}">
                  <label for="technology-status">Owner</label>
                  <input type="email" class="form-control" name="ownerEmail" ng-model="technology.ownerEmail" ng-disabled="technology.loadedByPipedrive" placeholder="[login]@ciandt.com">
                  <div ng-show="addTechnologyForm.$submitted || addTechnologyForm.ownerEmail.$touched">
                    <span ng-show="addTechnologyForm.ownerEmail.$invalid" class="help-block">Email inválido</span>
                  </div>
                </div>
                <div class="form-group col-md-6" ng-show="loggedUserInformation.admin">
                  <label for="technology-status">Selecione o status da proposta</label> </br>
                  <div class="btn-group" uib-dropdown ng-style="{'background-color': technology.backgroundColor}">
                    <button id="single-button" type="button" ng-disabled="technology.loadedByPipedrive" class="btn btn-default" uib-dropdown-toggle>
                      {{ technology.selectedStatus==null ? 'Status Proposta' : technology.selectedStatus }}
                      <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="single-button">
                      <li role="menuitem" ng-repeat="item in technology.dropDownStatus">
                        <a ng-show="item != 'Todos' && item != 'Não informado'" ng-click="technology.selectStatus(item)">{{item}}</a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="form-group col-md-12" >
                  <label for="technology-offer">Selecione a oferta</label> </br>
                  <ui-select multiple  ng-model="batata" theme="select2"  style="width: 300px;">
                    <ui-select-match placeholder="Selecione ofertas...">{{$item}}</ui-select-match>
                    <ui-select-choices repeat="item in technology.dropDownOffer | filter:$select.search">
                      {{item}}
                    </ui-select-choices>
                  </ui-select>
                </div>
              </div>
              <div class="row">
                <div class="form-group col-md-12" ng-class="{'has-error': (addTechnologyForm.shortDescription.$invalid && addTechnologyForm.shortDescription.$touched) || (addTechnologyForm.$submitted && addTechnologyForm.shortDescription.$invalid)}">
                  <label for="technology-shortDescription">Resumo</label>
                  <textarea class="form-control" id="technology-shortDescription" name="shortDescription" ng-model="technology.shortDescription" maxlength="140"  style="max-height: 50px; height: 50px; " placeholder="O resumo é o texto que aparece no card" required></textarea>
                  <div ng-show="addTechnologyForm.$submitted || addTechnologyForm.shortDescription.$touched">
                    <span ng-show="addTechnologyForm.shortDescription.$error.required" class="help-block">O campo Resumo é obrigatório</span>
                  </div>
                </div>
                <div class="form-group col-md-12" ng-class="{'has-error': (addTechnologyForm.description.$invalid && addTechnologyForm.description.$touched) || (addTechnologyForm.$submitted && addTechnologyForm.description.$invalid)}">
                  <label for="technology-description">Descrição</label>
                  <textarea class="form-control" id="technology-description" style="min-height: 50px; height: 100px; max-height: 300px;" name="description" ng-model="technology.description" maxlength="2000" placeholder="Uma descrição mais detalhada ajudará nas buscas" required></textarea>
                  <div ng-show="addTechnologyForm.$submitted || addTechnologyForm.description.$touched">
                    <span ng-show="addTechnologyForm.description.$error.required" class="help-block">O campo Descrição é obrigatório</span>
                  </div>
                </div>
                <div class="form-group col-md-12" ng-class="{'has-error': (addTechnologyForm.website.$invalid && addTechnologyForm.website.$touched) || (addTechnologyForm.$submitted && addTechnologyForm.website.$invalid)}">
                  <label for="technology-website">Link da pasta do drive</label>
                  <input type="text" class="form-control" ng-pattern='technology.regexGoogledrive' name="website" id="technology-website" ng-model="technology.webSite" placeholder="https://drive.google.com/open?id={}">
                  <div ng-show="addTechnologyForm.$submitted || addTechnologyForm.website.$touched">
                    <span ng-show="addTechnologyForm.website.$invalid" class="help-block">O link do Google Drive está incorreto</span>
                  </div>
                </div>
                <div class="form-group col-md-12">
                  <label for="technology-technologies">Principais tecnologias envolvidas</label>
                  <input type="text" class="form-control" id="technology-technologies" ng-model="technology.technologies" placeholder="Ex: Google GAE, Android, AngularJs">
                  <span class="help-block">(separe por vírgula)</span>
                </div>
                <div class="form-inline col-md-12 text-right">
                  <div class="checkbox" ng-if="!technology.id.length">
                    <label>
                      <input type="checkbox" ng-model="technology.addNew"> Adicionar outra
                    </label>
                  </div>
                  <button type="submit" class="btn btn-primary" ng-disabled="addTechnologyForm.$invalid" ng-if="technology.id.length">Salvar proposta</button>
                  <button type="submit" class="btn btn-primary" ng-disabled="addTechnologyForm.$invalid" ng-if="!technology.id.length">Adicionar proposta</button>
                  <a href="#/proposals" class="btn btn-link">Cancelar</a>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
